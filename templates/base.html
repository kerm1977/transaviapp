<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP</title>

    <!-- Importar ionicons para los iconos -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
 
    <!-- Incluir jQuery para las funcionalidades de Flash (opcional pero ayuda) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<!-- El tema se establece dinámicamente en el script de abajo -->
<body class="theme-dark"> 
    
    <!-- ESTRUCTURA 1: LOGO SUPERIOR IZQUIERDA (150px x 150px) -->
    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="App Logo" class="app-logo">

    <!-- Contenedor para mensajes flash -->
    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    
    <!-- NUEVO WRAPPER CENTRADO CON Z-INDEX BAJO (1000) -->
    <!-- Este es el contenedor principal que define el área del blur -->
    <div class="header-title-wrapper">
        <!-- Contenedor para el efecto blur (capa de fondo) -->
        <div class="app-title-backdrop"></div>
        
        <!-- TÍTULO CENTRADO (Capa de contenido) -->
        <div class="app-title">TRANSAVI</div>
    </div>


    <!-- ESTRUCTURA 2: BARRA SUPERIOR CON TÍTULO Y BOTONES -->
    <div class="nav-header-container">
        <!-- Barra Superior Derecha: Muestra solo el botón de tema -->
        <div class="nav-header-info">
            <!-- NOTA: El saludo y el botón de Cerrar Sesión fueron eliminados de aquí.
                 El cierre de sesión ahora se gestiona desde la página de perfil. -->

            <!-- Botón de cambio de tema: AQUI NO SE PUEDE MOVER NI MODIFICAR ABSOLUTAMENTE NADA DE EL  -->
            <button id="theme-toggle" title="Cambiar Tema">
                <ion-icon name="color-palette-outline"></ion-icon>
            </button>
        </div>
    </div>


    <!-- Contenido de la vista (Index, Login, Register, etc.) -->
    <!-- El body centra vertical y horizontalmente este div -->
    <!-- Clase page-loading por defecto para aplicar fade-in al cargar -->
    <div class="content page-loading" id="main-content">
        <!-- Mostramos el título de la página si se pasó como argumento (para las nuevas rutas) -->
        {% if page_title and page_title != "Inicio" %}
            <h1 style="font-size: 2.5em; margin-bottom: 20px; color: var(--clr-main);">
                <ion-icon name="{{ 'chatbubble-outline' if page_title == 'Mensajes' else ('camera-outline' if page_title == 'Fotos' else 'settings-outline') }}" style="vertical-align: middle;"></ion-icon>
                {{ page_title }}
            </h1>
            <p style="font-size: 1.1em; margin-bottom: 30px; color: var(--clr-text-content);">
                Contenido de la sección de {{ page_title | lower }}.
            </p>
        {% endif %}
        
        {% block content %}{% endblock %}
    </div>


    <!-- ======================================================= -->
    <!-- ESTRUCTURA HTML - NAVBAR INFERIOR (SIEMPRE VISIBLE) -->
    <!-- ======================================================= -->
    <div class="navigation">
        <ul>
            <!-- Elementos de la lista -->
            <li class="list active" data-icon-name="home-outline" data-path="index">
                <a href="{{ url_for('main.index') }}">
                    <span class="icon">
                        <ion-icon name="home-outline"></ion-icon>
                    </span>
                    <span class="text">Inicio</span>
                </a>
            </li>
            
            <!-- ENLACE DINÁMICO DE PERFIL/LOGIN -->
            <li class="list" data-icon-name="person-circle-outline" data-path="profile">
                <!-- Único enlace que mantiene la lógica condicional -->
                <a href="{{ url_for('main.profile') if session.logged_in else url_for('auth.login') }}">
                    <span class="icon">
                        <ion-icon name="person-circle-outline"></ion-icon>
                    </span>
                    <span class="text">
                        {% if session.logged_in %}Perfil{% else %}Acceder{% endif %}
                    </span>
                </a>
            </li>
            
            <!-- ENLACE A MENSAJES (Ruta directa) -->
            <li class="list" data-icon-name="chatbubble-outline" data-path="messages">
                <a href="{{ url_for('main.messages') }}">
                    <span class="icon">
                        <ion-icon name="chatbubble-outline"></ion-icon>
                    </span>
                    <span class="text">Mensajes</span>
                </a>
            </li>
            
            <!-- ENLACE A FOTOS (Ruta directa) -->
            <li class="list" data-icon-name="camera-outline" data-path="photos">
                <a href="{{ url_for('main.photos') }}">
                    <span class="icon">
                        <ion-icon name="camera-outline"></ion-icon>
                    </span>
                    <span class="text">Fotos</span>
                </a>
            </li>
            
            <!-- ENLACE A AJUSTES (Ruta directa) -->
            <li class="list" data-icon-name="settings-outline" data-path="settings">
                <a href="{{ url_for('main.settings') }}">
                    <span class="icon">
                        <ion-icon name="settings-outline"></ion-icon>
                    </span>
                    <span class="text">Ajustes</span>
                </a>
            </li>

            <!-- INDICADOR: Ahora solo contendrá el ícono activo inyectado por JS -->
            <div class="indicator">
                <!-- Ícono de reemplazo. Se inyecta aquí con JS -->
            </div>
        </ul>
    </div>

    {% block scripts %}{% endblock %}

    <!-- ======================================================= -->
    <!-- COMPORTAMIENTO JAVASCRIPT (Responsivo, Centrado y Temas) -->
    <!-- ======================================================= -->
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>
